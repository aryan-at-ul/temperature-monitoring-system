<!-- dashboard/templates/dashboard.html -->
{% extends "base.html" %}

{% block title %}Dashboard - Temperature Monitoring System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="bi bi-thermometer-half me-2"></i>Temperature Overview
                </h5>
                <div>
                    <select id="facility-selector" class="form-select form-select-sm d-inline-block w-auto me-2">
                        <option value="all">All Facilities</option>
                        <!-- Facilities will be populated by JavaScript -->
                    </select>
                    <select id="time-range-selector" class="form-select form-select-sm d-inline-block w-auto">
                        <option value="6">Last 6 Hours</option>
                        <option value="12">Last 12 Hours</option>
                        <option value="24" selected>Last 24 Hours</option>
                        <option value="48">Last 2 Days</option>
                        <option value="168">Last Week</option>
                    </select>
                    <button id="refresh-btn" class="btn btn-sm btn-outline-primary ms-2">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="temperature-chart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-thermometer me-2"></i>Current Temperatures
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table id="current-temps-table" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Unit</th>
                                <th>Facility</th>
                                <th>Temperature</th>
                                <th>Status</th>
                                <th>Last Updated</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data will be populated by JavaScript -->
                            <tr>
                                <td colspan="5" class="text-center">Loading data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-exclamation-triangle me-2"></i>Alerts
                </h5>
            </div>
            <div class="card-body">
                <div id="alerts-container">
                    <!-- Alerts will be populated by JavaScript -->
                    <div class="text-center text-muted">
                        <i class="bi bi-hourglass-split"></i> Loading alerts...
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-building me-2"></i>Facilities Overview
                </h5>
            </div>
            <div class="card-body">
                <div id="facilities-container" class="row">
                    <!-- Facilities will be populated by JavaScript -->
                    <div class="col-12 text-center text-muted">
                        <i class="bi bi-hourglass-split"></i> Loading facilities...
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Temperature Unit Detail Modal -->
<div class="modal fade" id="unit-detail-modal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Unit Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>Unit:</strong> <span id="modal-unit-name"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Facility:</strong> <span id="modal-facility-name"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Current Temperature:</strong> <span id="modal-current-temp"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Target Temperature:</strong> <span id="modal-target-temp"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Status:</strong> <span id="modal-status"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>Equipment Type:</strong> <span id="modal-equipment-type"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Size:</strong> <span id="modal-size"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Last Update:</strong> <span id="modal-last-update"></span>
                        </div>
                    </div>
                </div>
                <div class="mt-3">
                    <h6>Temperature History (24h)</h6>
                    <div class="chart-container">
                        <canvas id="unit-history-chart"></canvas>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize dashboard with default values
        updateDashboard();
        
        // Set up event listeners
        document.getElementById('facility-selector').addEventListener('change', updateDashboard);
        document.getElementById('time-range-selector').addEventListener('change', updateDashboard);
        document.getElementById('refresh-btn').addEventListener('click', updateDashboard);
        
        // Set up auto-refresh every 5 minutes
        setInterval(updateDashboard, 300000);
    });
</script>
{% endblock %}